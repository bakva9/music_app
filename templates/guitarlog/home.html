{% extends "base.html" %}

{% block title %}練習記録 - 残音{% endblock %}

{% block content %}
<h1 class="font-display text-2xl font-bold text-cosmic-800 dark:text-white text-glow mb-6">練習記録</h1>

<!-- Weekly Goal Progress -->
{% if goal_progress %}
<div class="bg-white/80 dark:bg-white/5 backdrop-blur-md rounded-2xl p-5 border border-cosmic-200/30 dark:border-white/10 mb-6">
    <div class="flex justify-between items-center mb-2">
        <span class="text-sm font-medium text-cosmic-700 dark:text-white/70">今週の練習目標</span>
        <a href="{% url 'guitarlog:set_goal' %}" class="text-xs text-nebula-500 dark:text-nebula-300 hover:text-nebula-400 transition-colors">変更</a>
    </div>
    <div class="w-full bg-cosmic-100/50 dark:bg-white/10 rounded-full h-3 overflow-hidden">
        <div class="h-full rounded-full transition-all duration-500 {% if goal_progress.pct >= 100 %}bg-gradient-to-r from-green-400 to-emerald-500{% else %}bg-gradient-to-r from-cosmic-500 to-nebula-500{% endif %}"
             style="width: {{ goal_progress.pct }}%"></div>
    </div>
    <div class="flex justify-between mt-2 text-xs text-cosmic-600/60 dark:text-white/50">
        <span>{{ goal_progress.current }}分 / {{ goal_progress.target }}分</span>
        <span>{% if goal_progress.pct >= 100 %}達成！{% else %}{{ goal_progress.pct }}%{% endif %}</span>
    </div>
</div>
{% else %}
<div class="bg-white/80 dark:bg-white/5 backdrop-blur-md rounded-2xl p-5 border border-cosmic-200/30 dark:border-white/10 mb-6">
    <div class="flex justify-between items-center">
        <span class="text-sm text-cosmic-600/60 dark:text-white/50">週間目標を設定して練習を継続しましょう</span>
        <a href="{% url 'guitarlog:set_goal' %}" class="text-sm bg-gradient-to-r from-cosmic-500 to-nebula-500 hover:from-cosmic-400 hover:to-nebula-400 text-white px-4 py-1.5 rounded-lg font-medium shadow-glow transition-all duration-300">目標を設定</a>
    </div>
</div>
{% endif %}

<!-- Streak & Stats -->
<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8">
    <div class="bg-white/80 dark:bg-white/5 backdrop-blur-md rounded-2xl p-6 border border-cosmic-200/30 dark:border-white/10 text-center">
        <div class="text-4xl font-mono font-bold text-cosmic-500 dark:text-cosmic-300 text-glow">{{ streak }}</div>
        <div class="text-sm text-cosmic-600/60 dark:text-white/50 mt-1">日連続ストリーク</div>
    </div>
    <div class="bg-white/80 dark:bg-white/5 backdrop-blur-md rounded-2xl p-6 border border-cosmic-200/30 dark:border-white/10 text-center">
        <div class="text-4xl font-mono font-bold text-cosmic-500 dark:text-cosmic-300 text-glow">{{ total_minutes }}</div>
        <div class="text-sm text-cosmic-600/60 dark:text-white/50 mt-1">分（累計練習時間）</div>
    </div>
    <div class="bg-white/80 dark:bg-white/5 backdrop-blur-md rounded-2xl p-6 border border-cosmic-200/30 dark:border-white/10 text-center">
        <div class="text-4xl font-mono font-bold text-cosmic-500 dark:text-cosmic-300 text-glow">{{ recent_sessions|length }}</div>
        <div class="text-sm text-cosmic-600/60 dark:text-white/50 mt-1">最近のセッション</div>
    </div>
</div>

<!-- Quick Actions -->
<div class="flex flex-wrap gap-3 mb-8">
    <a href="{% url 'guitarlog:timer' %}" class="bg-gradient-to-r from-cosmic-500 to-nebula-500 hover:from-cosmic-400 hover:to-nebula-400 text-white px-6 py-3 rounded-xl font-display font-bold shadow-glow hover:shadow-glow-lg transition-all duration-300">タイマー練習</a>
    <a href="{% url 'guitarlog:quick_record' %}" class="bg-white/60 dark:bg-white/5 backdrop-blur-md text-cosmic-700 dark:text-white/70 px-6 py-3 rounded-xl font-medium border border-cosmic-200/30 dark:border-white/10 hover:bg-white/80 dark:hover:bg-white/10 transition-all duration-200">クイック記録</a>
    <a href="{% url 'guitarlog:song_list' %}" class="bg-white/60 dark:bg-white/5 backdrop-blur-md text-cosmic-700 dark:text-white/70 px-6 py-3 rounded-xl font-medium border border-cosmic-200/30 dark:border-white/10 hover:bg-white/80 dark:hover:bg-white/10 transition-all duration-200">練習曲</a>
    <a href="{% url 'guitarlog:stats' %}" class="bg-white/60 dark:bg-white/5 backdrop-blur-md text-cosmic-700 dark:text-white/70 px-6 py-3 rounded-xl font-medium border border-cosmic-200/30 dark:border-white/10 hover:bg-white/80 dark:hover:bg-white/10 transition-all duration-200">統計</a>
</div>

<!-- Recent Sessions -->
{% if recent_sessions %}
<h2 class="font-display text-lg font-bold text-cosmic-800 dark:text-white/90 mb-3">最近のセッション</h2>
<div class="space-y-2">
    {% for session in recent_sessions %}
    <div class="bg-white/80 dark:bg-white/5 backdrop-blur-md rounded-2xl p-4 border border-cosmic-200/30 dark:border-white/10">
        <div class="flex justify-between items-center">
            <div>
                <span class="font-medium">{{ session.started_at|date:"m/d" }}</span>
                <span class="text-cosmic-600/60 dark:text-white/50 ml-2">{{ session.duration_minutes }}分</span>
                {% if session.is_quick_record %}
                <span class="text-xs bg-cosmic-100/50 dark:bg-white/10 px-2 py-0.5 rounded ml-2">クイック</span>
                {% endif %}
            </div>
            {% if session.rating %}
            <div class="text-stardust">
                {% for i in "12345" %}{% if forloop.counter <= session.rating %}★{% else %}☆{% endif %}{% endfor %}
            </div>
            {% endif %}
        </div>
        {% if session.memo %}<p class="text-sm text-cosmic-600/60 dark:text-white/50 mt-1">{{ session.memo|truncatewords:20 }}</p>{% endif %}
    </div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}
