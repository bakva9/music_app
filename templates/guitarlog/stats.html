{% extends "base.html" %}

{% block title %}統計 - 残音{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <h1 class="font-display text-2xl font-bold text-cosmic-800 dark:text-white text-glow mb-6">練習統計</h1>

    <div class="bg-white/80 dark:bg-white/5 backdrop-blur-md rounded-2xl p-6 border border-cosmic-200/30 dark:border-white/10">
        <h2 class="font-display text-lg font-bold text-cosmic-800 dark:text-white/90 mb-4">週間練習時間</h2>
        <canvas id="weeklyChart" height="200"></canvas>
    </div>

    <div class="mt-6 text-center">
        <a href="{% url 'guitarlog:home' %}" class="text-cosmic-500 dark:text-cosmic-300 hover:text-cosmic-400 dark:hover:text-cosmic-200 transition-colors">&larr; 練習記録に戻る</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
fetch('{% url "guitarlog:stats_data" %}')
    .then(r => r.json())
    .then(data => {
        const isDark = document.documentElement.classList.contains('dark');
        new Chart(document.getElementById('weeklyChart'), {
            type: 'bar',
            data: {
                labels: data.labels,
                datasets: [{
                    label: '練習時間（分）',
                    data: data.data,
                    backgroundColor: isDark ? 'rgba(199, 48, 88, 0.7)' : 'rgba(199, 48, 88, 0.5)',
                    borderColor: 'rgb(199, 48, 88)',
                    borderWidth: 1,
                    borderRadius: 4,
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { color: isDark ? '#9ca3af' : '#6b7280' },
                        grid: { color: isDark ? '#374151' : '#e5e7eb' }
                    },
                    x: {
                        ticks: { color: isDark ? '#9ca3af' : '#6b7280' },
                        grid: { display: false }
                    }
                },
                plugins: { legend: { display: false } }
            }
        });
    });
</script>
{% endblock %}
