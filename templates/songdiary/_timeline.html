{% if project.memos.all %}
<div class="space-y-3 relative">
    <div class="absolute left-5 top-0 bottom-0 w-0.5 bg-cosmic-400/30 dark:bg-cosmic-400/20"></div>
    {% for memo in project.memos.all %}
    <div class="relative pl-10" data-memo-type="{{ memo.memo_type }}" x-data="{ editing: false }">
        <div class="absolute left-4 top-4 w-3 h-3 rounded-full bg-cosmic-400"></div>
        <div class="bg-white/80 dark:bg-white/5 backdrop-blur-md rounded-2xl p-4 border border-cosmic-200/30 dark:border-white/10">
            <div class="flex justify-between items-start">
                <div class="flex items-center gap-2 text-xs text-cosmic-600/60 dark:text-white/50 mb-2">
                    {% if memo.memo_type == 'text' %}<svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"/></svg>{% elif memo.memo_type == 'audio' %}<svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"/></svg>{% else %}<svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909M3.75 21h16.5A2.25 2.25 0 0 0 22.5 18.75V5.25A2.25 2.25 0 0 0 20.25 3H3.75A2.25 2.25 0 0 0 1.5 5.25v13.5A2.25 2.25 0 0 0 3.75 21Zm16.5-13.5h.008v.008h-.008V7.5Z"/></svg>{% endif %}
                    <span>{{ memo.created_at|date:"Y/m/d H:i" }}</span>
                </div>
                <div class="flex items-center gap-2">
                    {% if memo.memo_type == 'text' %}
                    <button @click="editing = !editing" x-show="!editing"
                            class="text-nebula-500 dark:text-nebula-300 hover:text-nebula-400 text-xs">編集</button>
                    {% endif %}
                    <button hx-post="{% url 'songdiary:delete_memo' project.pk memo.pk %}"
                            hx-target="#timeline" hx-swap="innerHTML" hx-confirm="削除しますか？"
                            class="text-comet dark:text-comet/80 hover:text-red-600 text-xs">×</button>
                </div>
            </div>
            {% if memo.memo_type == 'text' %}
            <!-- Display mode -->
            <p x-show="!editing" class="text-sm whitespace-pre-line">{{ memo.text_content }}</p>
            <!-- Edit mode -->
            <form x-show="editing" x-cloak
                  hx-post="{% url 'songdiary:edit_memo' project.pk memo.pk %}"
                  hx-target="#timeline" hx-swap="innerHTML"
                  class="space-y-2">
                {% csrf_token %}
                <textarea name="text_content" rows="3"
                          class="w-full rounded-xl border border-cosmic-200/30 dark:border-white/10 bg-white/80 dark:bg-white/5 px-3 py-2 text-sm focus:ring-2 focus:ring-cosmic-400/50">{{ memo.text_content }}</textarea>
                <div class="flex gap-2">
                    <button type="submit" class="bg-gradient-to-r from-cosmic-500 to-nebula-500 text-white px-3 py-1 rounded-lg text-xs font-bold">保存</button>
                    <button type="button" @click="editing = false" class="text-xs text-cosmic-600/60 dark:text-white/50 hover:text-cosmic-500">キャンセル</button>
                </div>
            </form>
            {% elif memo.memo_type == 'audio' %}
            <audio controls class="w-full" src="{{ memo.audio_file.url }}"></audio>
            {% elif memo.memo_type == 'photo' %}
            <img src="{{ memo.photo_file.url }}" alt="メモ写真" class="rounded-2xl max-h-64 object-cover">
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-8 text-cosmic-600/50 dark:text-white/40">
    <div class="w-20 h-20 mx-auto mb-4 opacity-60">{% include "partials/baku/_baku_sleeping.html" %}</div>
    メモがまだありません。上のフォームからメモを追加しましょう。
</div>
{% endif %}
